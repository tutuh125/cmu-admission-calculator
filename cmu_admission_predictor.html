<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMU Admission Predictor for Tabor Academy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/3.21.0/tf.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .predict-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s ease;
            font-weight: 600;
        }
        
        .predict-btn:hover {
            transform: translateY(-2px);
        }
        
        .predict-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 30px;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            display: none;
        }
        
        .result.high {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: #2d5016;
        }
        
        .result.medium {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #721c24;
        }
        
        .result.low {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #8b2635;
        }
        
        .training-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }
        
        .training-info h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-weight: 600;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ“ CMU Admission Predictor</h1>
            <p>Tabor Academy - Deep Learning Model</p>
        </div>
        
        <div class="training-info">
            <h3>Model Information</h3>
            <p>This neural network was trained on historical CMU admission data from Tabor Academy students. The model analyzes SAT/ACT scores, WGPA, decision plan, and SCS application status to predict admission chances.</p>
            <div id="modelStats" class="stats"></div>
        </div>
        
        <form id="predictionForm">
            <div class="form-group">
                <label for="satScore">SAT/ACT Score:</label>
                <input type="number" id="satScore" min="1200" max="1600" step="10" required 
                       placeholder="Enter SAT score (1200-1600) or ACT score (30-36)">
            </div>
            
            <div class="form-group">
                <label for="wgpa">Weighted GPA:</label>
                <input type="number" id="wgpa" min="3.0" max="5.0" step="0.01" required 
                       placeholder="Enter weighted GPA (3.0-5.0)">
            </div>
            
            <div class="form-group">
                <label for="decisionPlan">Decision Plan:</label>
                <select id="decisionPlan" required>
                    <option value="">Select decision plan</option>
                    <option value="RD">Regular Decision (RD)</option>
                    <option value="ED">Early Decision (ED)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="scsApplication">Applying to School of Computer Science (SCS):</label>
                <select id="scsApplication" required>
                    <option value="">Select SCS application status</option>
                    <option value="yes">Yes - Applying to SCS</option>
                    <option value="no">No - Not applying to SCS</option>
                </select>
            </div>
            
            <button type="submit" class="predict-btn" id="predictBtn" disabled>
                <span id="btnText">Training Model...</span>
                <span id="loadingText" class="loading" style="display: none;">Analyzing...</span>
            </button>
        </form>
        
        <div id="result" class="result"></div>
    </div>

    <script>
        // Training data from the provided dataset
        const trainingData = [
            {sat: 1520, wgpa: 4.43, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1580, wgpa: 4.38, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1460, wgpa: 4.19, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1520, wgpa: 3.98, plan: 'ED', decision: 'ACCEPTED'},
            {sat: 1520, wgpa: 3.96, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1580, wgpa: 4.17, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1540, wgpa: 3.98, plan: 'RD', decision: 'ACCEPTED'},
            {sat: 1540, wgpa: 4.33, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1570, wgpa: 4.15, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1540, wgpa: 4.1, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1510, wgpa: 4.16, plan: 'RD', decision: 'DENIED'},
            {sat: 1530, wgpa: 3.99, plan: 'RD', decision: 'DENIED'},
            {sat: 1530, wgpa: 3.87, plan: 'ED', decision: 'DENIED'},
            {sat: 1430, wgpa: 4.05, plan: 'RD', decision: 'DENIED'},
            {sat: 1530, wgpa: 3.87, plan: 'ED', decision: 'DENIED'},
            {sat: 1580, wgpa: 3.84, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1570, wgpa: 3.8, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1550, wgpa: 3.83, plan: 'RD', decision: 'DENIED'},
            {sat: 1410, wgpa: 3.7, plan: 'ED', decision: 'DENIED'},
            {sat: 1460, wgpa: 3.68, plan: 'RD', decision: 'DENIED'},
            {sat: 1380, wgpa: 3.79, plan: 'RD', decision: 'DENIED'},
            {sat: 1310, wgpa: 3.79, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1530, wgpa: 4.16, plan: 'RD', decision: 'DENIED'}, // ACT 34 â‰ˆ 1530 SAT
            {sat: 1530, wgpa: 3.89, plan: 'RD', decision: 'WAITLISTED'},
            {sat: 1530, wgpa: 3.83, plan: 'RD', decision: 'DENIED'}
        ];

        let model;
        let isModelTrained = false;

        // Normalize features
        function normalizeFeatures(sat, wgpa, plan) {
            const normalizedSat = Math.max(0, Math.min(1, (sat - 1200) / 400)); // Normalize SAT to 0-1 range
            const normalizedWgpa = Math.max(0, Math.min(1, (wgpa - 3.0) / 2.0)); // Normalize WGPA to 0-1 range
            const planValue = plan === 'ED' ? 1 : 0; // ED = 1, RD = 0
            return [normalizedSat, normalizedWgpa, planValue];
        }

        // Convert decision to numerical value
        function decisionToNumber(decision) {
            switch(decision) {
                case 'ACCEPTED': return 1;
                case 'WAITLISTED': return 0.5;
                case 'DENIED': return 0;
                default: return 0;
            }
        }

        // Create and train the model
        async function createAndTrainModel() {
            try {
                // Wait for TensorFlow to be ready
                await tf.ready();
                
                // Prepare training data
                const inputs = trainingData.map(d => normalizeFeatures(d.sat, d.wgpa, d.plan));
                const outputs = trainingData.map(d => [decisionToNumber(d.decision)]);

                const xs = tf.tensor2d(inputs);
                const ys = tf.tensor2d(outputs);

                // Create model
                model = tf.sequential({
                    layers: [
                        tf.layers.dense({
                            inputShape: [3],
                            units: 16,
                            activation: 'relu'
                        }),
                        tf.layers.dropout({rate: 0.2}),
                        tf.layers.dense({
                            units: 8,
                            activation: 'relu'
                        }),
                        tf.layers.dropout({rate: 0.2}),
                        tf.layers.dense({
                            units: 1,
                            activation: 'sigmoid'
                        })
                    ]
                });

                // Compile model
                model.compile({
                    optimizer: tf.train.adam(0.001),
                    loss: 'meanSquaredError',
                    metrics: ['mse']
                });

                // Train model
                await model.fit(xs, ys, {
                    epochs: 100,
                    validationSplit: 0.2,
                    shuffle: true,
                    verbose: 0
                });

                // Clean up tensors
                xs.dispose();
                ys.dispose();

                isModelTrained = true;
                displayModelStats();
                
            } catch (error) {
                console.error('Model training error:', error);
                throw error;
            }
        }

        function displayModelStats() {
            const accepted = trainingData.filter(d => d.decision === 'ACCEPTED').length;
            const waitlisted = trainingData.filter(d => d.decision === 'WAITLISTED').length;
            const denied = trainingData.filter(d => d.decision === 'DENIED').length;
            const edApplicants = trainingData.filter(d => d.plan === 'ED').length;
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${trainingData.length}</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${accepted}</div>
                    <div class="stat-label">Accepted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${waitlisted}</div>
                    <div class="stat-label">Waitlisted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${denied}</div>
                    <div class="stat-label">Denied</div>
                </div>
            `;
            
            document.getElementById('modelStats').innerHTML = statsHtml;
        }

        // Make prediction
        async function predict(sat, wgpa, plan, scs) {
            if (!isModelTrained) {
                throw new Error('Model not trained yet');
            }

            try {
                if (model) {
                    // Use neural network model
                    const normalizedInputs = normalizeFeatures(sat, wgpa, plan);
                    const prediction = model.predict(tf.tensor2d([normalizedInputs]));
                    const probabilityArray = await prediction.data();
                    let probability = probabilityArray[0];
                    prediction.dispose();
                    
                    // Adjust probability based on SCS application
                    if (scs === 'yes') {
                        probability *= 0.85;
                    }
                    
                    return Math.max(0, Math.min(1, probability));
                } else {
                    // Fallback statistical model
                    return statisticalPredict(sat, wgpa, plan, scs);
                }
            } catch (error) {
                console.error('Neural network prediction failed, using statistical model:', error);
                return statisticalPredict(sat, wgpa, plan, scs);
            }
        }

        // Fallback statistical prediction
        function statisticalPredict(sat, wgpa, plan, scs) {
            // Calculate base probability based on historical data patterns
            let probability = 0;
            
            // SAT score factor
            if (sat >= 1570) probability += 0.4;
            else if (sat >= 1540) probability += 0.3;
            else if (sat >= 1520) probability += 0.25;
            else if (sat >= 1500) probability += 0.2;
            else if (sat >= 1450) probability += 0.15;
            else probability += 0.1;
            
            // WGPA factor
            if (wgpa >= 4.3) probability += 0.3;
            else if (wgpa >= 4.1) probability += 0.25;
            else if (wgpa >= 4.0) probability += 0.2;
            else if (wgpa >= 3.9) probability += 0.15;
            else probability += 0.1;
            
            // Plan factor (ED slight boost)
            if (plan === 'ED') probability += 0.05;
            
            // SCS factor (more competitive)
            if (scs === 'yes') probability *= 0.8;
            
            return Math.max(0, Math.min(1, probability));
        }

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const sat = parseFloat(document.getElementById('satScore').value);
            const wgpa = parseFloat(document.getElementById('wgpa').value);
            const plan = document.getElementById('decisionPlan').value;
            const scs = document.getElementById('scsApplication').value;
            
            // Convert ACT to SAT if needed (more accurate conversion)
            let convertedSat = sat;
            if (sat <= 36) {
                // ACT to SAT conversion table approximation
                const actToSat = {
                    34: 1530, 35: 1560, 36: 1590,
                    33: 1500, 32: 1470, 31: 1440,
                    30: 1410, 29: 1380, 28: 1350
                };
                convertedSat = actToSat[sat] || (sat * 44 + 590);
            }
            
            const btn = document.getElementById('predictBtn');
            const btnText = document.getElementById('btnText');
            const loadingText = document.getElementById('loadingText');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            loadingText.style.display = 'inline';
            
            try {
                if (!isModelTrained) {
                    throw new Error('Model is still training. Please wait a moment.');
                }
                
                const probability = await predict(convertedSat, wgpa, plan, scs);
                const percentage = Math.round(probability * 100);
                
                const resultDiv = document.getElementById('result');
                let resultClass, resultText;
                
                if (percentage >= 70) {
                    resultClass = 'high';
                    resultText = `ðŸŽ‰ High Admission Chance: ${percentage}%`;
                } else if (percentage >= 40) {
                    resultClass = 'medium';
                    resultText = `ðŸ¤” Moderate Admission Chance: ${percentage}%`;
                } else {
                    resultClass = 'low';
                    resultText = `ðŸ“š Lower Admission Chance: ${percentage}%`;
                }
                
                resultDiv.className = `result ${resultClass}`;
                resultDiv.innerHTML = `
                    <div>${resultText}</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                        ${scs === 'yes' ? 'SCS applications are highly competitive' : 'Consider your intended major and fit'}
                    </div>
                `;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                console.error('Prediction error:', error);
                const resultDiv = document.getElementById('result');
                resultDiv.className = 'result low';
                resultDiv.innerHTML = 'Error making prediction. Please try again.';
                resultDiv.style.display = 'block';
            } finally {
                btn.disabled = false;
                btnText.style.display = 'inline';
                loadingText.style.display = 'none';
            }
        });

        // Initialize the model when page loads
        window.addEventListener('load', async () => {
            // Add a small delay to ensure TensorFlow is fully loaded
            setTimeout(async () => {
                try {
                    console.log('Starting model training...');
                    console.log('TensorFlow version:', tf.version.tfjs);
                    await createAndTrainModel();
                    console.log('Model trained successfully');
                    document.getElementById('predictBtn').disabled = false;
                    document.getElementById('btnText').textContent = 'Predict Admission Chance';
                } catch (error) {
                    console.error('Error training model:', error);
                    document.getElementById('predictBtn').disabled = true;
                    document.getElementById('btnText').textContent = 'Model Training Failed - Check Console';
                    
                    // Fallback: Simple statistical model
                    console.log('Falling back to statistical model...');
                    isModelTrained = true;
                    displayModelStats();
                    document.getElementById('predictBtn').disabled = false;
                    document.getElementById('btnText').textContent = 'Predict Admission Chance (Statistical Model)';
                }
            }, 1000);
        });
    </script>
</body>
</html>